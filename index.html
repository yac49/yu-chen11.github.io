<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500&display=swap" rel="stylesheet">
  <title>比特幣匯率轉換</title>
</head>

<body>
  <h1><img class="animated-gif" src="image/bitcoin.gif" alt="Loading" title="Loading">比特幣轉換美金小工具</h1>
  <div>
    匯率日期：<input id="date" type="date" value="2021-06-11" />
    <script>
      date.max = new Date().toISOString().split("T")[0];
    </script>

    <input type="text" id="bitcoin" value="100" required>比特幣
    <button onclick="change()">轉換</button>
    為 <h id="price"> </h> 美金
  </div>
  <table border=3px>
    <thead>
      <th style="background-color:cornflowerblue">當前匯率</th>
    </thead>
    <tr>
      <td>1 比特幣 約為<h id="usdollar"> </h>美金</td>
    </tr>
  </table>
  <script>
    change();
    function change() {
      var x = document.getElementById("bitcoin").value;
      if (isNaN(x)) {
        alert("請輸入數字");
        return false;
      }
      var date = document.getElementById("date").value;
      var bitcoin = document.getElementById("bitcoin").value;
      var api_url = "https://api.coindesk.com/v1/bpi/historical/close.json?start=" + date + "&end=" + date;
      fetch(api_url).then(res => res.json())
        .then((out) => {
          document.getElementById("price").innerHTML = Object.values(out.bpi) * bitcoin;
          document.getElementById("usdollar").innerHTML = Object.values(out.bpi);
        }).catch(err => alert('something error'));
    }

  </script>
</body>

</html>
